# 产品需求与设计文档（PRD+HLD）

> 本文档整理自项目初期的需求讨论，记录了平台的核心设计理念和配置化架构。

## 1. 文档总览

### 1.1 产品目标

做一个"结构仿真智能组 Web 平台"，支持用户从**在线提单**到**自动化流程执行**再到**结果回显+多维分析**的全链路闭环；同时平台具备**企业级配置化能力**（项目/仿真类型/参数模板/工况输出/流程/状态/权限/自动化模块等全部可配置）。

### 1.2 核心原则

- **配置驱动**：提单数据主要存储"配置ID引用"，减少冗余；但"已应用到提单的模板内容"需要**快照**（允许提单后编辑，不影响配置表）。
- **强交互、强现代感**：提单页是核心竞争力，必须"丝滑、流畅、可缩放、可跳转定位、可检查修复"。
- **性能优先**：列表页可能几千条；结果页单单可能轮次到 2 万（常规 500 内），必须分离页面 + 虚拟列表/分页/抽样。
- **权限与扩展**：左侧菜单栏 + 权限控制（页面级权限ID）+ 无权限/申请权限链路。
- **国际化与主题**：中英文可切换 + 亮色默认 + 护眼 + 夜间模式。

---

## 2. 信息架构与菜单（左侧菜单栏）

> 菜单根据用户权限动态渲染；无权限跳转"无权限页"，可进入"申请权限页"。

### 2.1 一级模块

1. **工作台 / Dashboard**
   - 我的待办、运行中申请单、失败告警、近7天趋势等

2. **在线提单**
   - 提单画布（核心页面）

3. **申请单**
   - 申请单列表（海量）
   - 申请单详情/结果（单一申请单，多仿真类型，带分析）

4. **配置中心（全配置化）**
   - 项目列表基础配置
   - 仿真类型基础配置（至少 5 种）
   - 基础参数配置（全局）
   - 参数模板集配置（按仿真类型）
   - 基础工况配置（全局）
   - 输出模板配置（全局）
   - 工况+输出集配置（可成套 set）
   - 求解器配置
   - 状态/流程配置（含流程图）
   - 自动化模块配置
   - 权限配置

5. **系统管理**
   - 用户管理
   - 角色管理
   - 日志审计

---

## 3. 核心功能模块

### 3.1 在线提单（核心页面）

**设计要求：**

- 左侧：项目选择 + 仿真类型多选（至少5种）
- 右侧：动态表单区域（根据选择的仿真类型动态加载）
- 支持：折叠/展开、跳转定位、实时校验、错误提示
- 性能：大表单优化、虚拟滚动

### 3.2 申请单列表

**功能要求：**

- 支持海量数据（几千条）
- 高级筛选：项目、状态、时间范围、仿真类型
- 分页/虚拟滚动
- 批量操作

### 3.3 申请单详情/结果

**功能要求：**

- 多仿真类型结果展示
- 数据可视化（图表）
- 结果对比分析
- 导出功能

### 3.4 配置中心

**设计理念：**

- 所有配置项可动态管理
- 配置变更不影响已提交的申请单（快照机制）
- 配置项支持版本管理
- 配置项支持导入/导出

---

## 4. 技术架构

### 4.1 前端技术栈

- React 19 + TypeScript
- Zustand（状态管理）
- TailwindCSS（样式）
- React Router（路由）
- Recharts（图表）

### 4.2 后端技术栈

- Python 3.14 + Flask 3.x
- SQLAlchemy 2.x（ORM）
- Pydantic 2.x（数据验证）
- SQLite/PostgreSQL（数据库）

### 4.3 架构设计

- 前后端分离
- RESTful API
- 四层架构（Routes/Service/Repository/Schemas）
- 配置驱动 + 快照机制

---

## 5. 数据模型设计

### 5.1 核心实体

1. **项目（Project）**
2. **仿真类型（SimulationType）**
3. **参数配置（ParameterConfig）**
4. **工况配置（WorkConditionConfig）**
5. **输出配置（OutputConfig）**
6. **申请单（Order）**
7. **用户（User）**
8. **权限（Permission）**

### 5.2 配置快照机制

申请单提交时，系统会创建配置快照，确保：

- 配置变更不影响已提交的申请单
- 申请单可以独立编辑（不影响配置模板）
- 历史数据可追溯

---

## 6. 性能优化策略

1. **前端优化**
   - 虚拟列表/虚拟滚动
   - 懒加载/按需加载
   - 代码分割
   - 缓存策略

2. **后端优化**
   - 数据库索引优化
   - 查询优化
   - 分页查询
   - Redis缓存

---

## 7. 安全与权限

1. **认证机制**
   - JWT Token
   - 刷新Token机制

2. **权限控制**
   - 基于角色的访问控制（RBAC）
   - 页面级权限
   - 操作级权限
   - 数据级权限

---

## 8. 国际化与主题

1. **国际化**
   - 中英文切换
   - 动态语言包加载

2. **主题**
   - 亮色模式（默认）
   - 护眼模式
   - 夜间模式

---

**文档状态：** 初始版本  
**最后更新：** 2024年  
**维护者：** 项目组
